# Ruby合宿2023春・サンプルゲーム

本プログラムはRuby合宿2023春（以下、「本合宿」）用のサンプルゲームで、DXRuby（https://dxruby.osdn.jp/）を用いた「2Dパズルゲーム」です。


## Rubyバージョンについて

2023/01/30現在、DXRubyの最新バージョン（1.4.7）はRuby2.5～3.0(32bit)及び2.6～3.0(64bit)までのWindows版Rubyに対応しています。
本合宿では、Ruby 3.0系を前提として実施しますが、現在の3.0系最新バージョンである3.0.5からは、DXRubyが依存するdllに変化が生じているためDXRubyが起動できない事象を確認しています。
そのため、本合宿においては、Rubyのバージョンは32bit版/64bit版いずれでも、3.0.4を使用することを前提とします。


## 起動方法

本ファイル（Readme.txt）が存在するディレクトリをカレントディレクトリとして、以下のように起動してください。

```
ruby main.rb
```


## ゲームの説明

起動直後のタイトル画面にゲームのプレイ方法の説明があります。

タイトル画面からマウスクリックまたはスペースキー押下でゲーム本編シーンに移行します。
シーン（マップ）は2つ用意しています。
各シーンには制限時間があり、右下に表示され1秒毎にカウントダウンします。時間切れで次のシーンに遷移し、2つのシーンが終わるとエンディングシーンに切り替わります。

ゲームは1人でもプレイできますが、1シーン毎にプレイヤーを交代して、エンディング時にどちらのシーンが高得点か比較することもできるようになっています。
※ その場合は両シーン共に同一マップにしないと不公平ではありますが。

マウス左クリックで、マップ上のブロックを壊すことができますが、1個のブロックを壊すと得点が-1点されます。
※ 中には壊せないブロックもあります。

横方向に5個同じ種類のブロックが静止状態で並ぶと一括で消去され、加点（+10点）が得られます。

なるべく少ない破壊数で5個のブロックを並べることが、高得点へのコツとなります。

また、マップは表示されている領域よりもかなり広いので、マウスの右ドラッグでスクロールさせながらプレイを続けることになります。


## マップデータの作成

マップデータのファイルは、「maps」ディレクトリに「level_1.map」「level_2.map」のように格納されています。
※ 中身は単なるCSVです。

手でこれを編集するのは大変なので、簡単なマップエディタを同梱しています。
以下のようにしてマップファイルを編集できます。

```
ruby map_editor.rb マップファイル名
```

「マップファイル名」部分には、拡張子を除いたマップデータファイルの名称を指定してください。
例えば「level_1.map」を編集するのであれば、

```
ruby map_editor.rb level_1
```

のようになります。
※ マップデータは「maps」ディレクトリに入っているものだけを対象とするよう固定してあります。

マップエディタが起動したら、編集領域を右ドラッグでスクロールしながら、エディタ右側に並んだマップチップを選択しながら、マウス左クリック/左ドラッグで配置していきます。
エディタ下側に「保存する」「初期化する」「クリア」のボタンがあります。
それぞれ、

* 保存する   → マップデータを保存して「.map」ファイルを更新する
* 初期化する → 編集内容を破棄し、初期の配置に戻す
* クリア     → マップを真っ新な状態にする

という機能を持ちます。

マップ編集時の注意点としては、マップの外周を囲む破壊不可ブロックは消さないようにしてください。
これを消してしまうとスクロールの終端が判定できずゲームが壊れます。
